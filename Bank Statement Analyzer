import streamlit as st
import pandas as pd
import numpy as np

import plotly.express as px

header = st.container()
summary = st.container()
body = st.container()
#header container 
with header:
    st.write("""

    # Personal Finance Overview

    This is an overview of the expenses for the month...

    Let's see how you did!

    """)
#summary container
with summary:
    #fetching file
    bank_statement = pd.read_excel('BankStatement.xlsx')
    #cleaning the data
    bank_statement.fillna(value = ' ',inplace = True)
    bank_statement.columns = ['Date Posted','Description', ' ', 'Debits', 'Credits', 'Balance']
    bank_statement.insert(1,'Type of Transaction','string')
    bank_statement.drop(columns = ' ',inplace = True)
    bank_statement = round(bank_statement[pd.to_numeric(bank_statement['Balance'],errors = 'coerce').notnull()],2)
    #bank_statement.drop(bank_statement.index[0:6],inplace = True)
    bank_statement['Debits'] = round(bank_statement['Debits'].apply(pd.to_numeric,errors='coerce'),2)
    bank_statement['Credits'] = round(bank_statement['Credits'].apply(pd.to_numeric,errors='coerce'),2)
    bank_statement[['Type of Transaction','Description']] = bank_statement['Description'].str.split('\n',n=1,expand=True)
    bank_statement.reset_index(drop = True, inplace = True)
    bank_statement['Type of Transaction'].fillna(value = ' ',inplace = True)
    bank_statement['Debits'].fillna(value = 0,inplace = True)
    bank_statement['Credits'].fillna(value = 0,inplace = True)
    bank_statement['Description'].fillna(value = ' ',inplace = True)
    #variables for max amount and date
    amount = round(bank_statement['Debits'].max(),2)
    date = bank_statement['Date Posted'].loc[bank_statement['Debits'].idxmax()]


    st.header('This information was from your statement from your December 2021 statement')
    st.subheader('This is the summary')
    st.write(bank_statement.head(6))

    st.write(f'\nYour biggest spend was {amount} on {date}.')


#body container
with body:
    st.header('Graphs to Visualize Your Spending')
    st.subheader('Throughout the month...')

    bar_fig = px.bar(bank_statement[6:],x = 'Date Posted', y= 'Debits')
    st.plotly_chart(bar_fig)
    fig = px.line(bank_statement[6:], x = 'Date Posted', y= 'Debits',title = 'December Spending',width = 850)
    st.plotly_chart(fig)

    small_debts = bank_statement.loc[bank_statement['Debits'] < 25] = 'Small Debits'
    pie_fig = px.pie(bank_statement,values='Debits',names = 'Description',title='By Percentages',width = 1000)
    st.plotly_chart(pie_fig)
